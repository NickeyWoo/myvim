#!/bin/sh

function clean()
{
    sudo rm -f $HOME/.vimrc
    sudo rm -f $HOME/.viminfo
    sudo rm -rf $HOME/.vim/plugged
}

function installvim()
{
    rm -rf $HOME/.vim/latest
    mkdir $HOME/.vim/latest
    cd $HOME/.vim/latest

    wget -O vim_v9.1.0927.tar.gz https://github.com/vim/vim/archive/refs/tags/v9.1.0927.tar.gz
    tar -zxvf vim_v9.1.0927.tar.gz
    cd vim-9.1.0927

    if [ -f "$HOME/.miniconda3/envs/my/bin/x86_64-conda-linux-gnu-gcc" ]; then
      export CC=$HOME/.miniconda3/envs/my/bin/x86_64-conda-linux-gnu-gcc
      export CXX=$HOME/.miniconda3/envs/my/bin/x86_64-conda-linux-gnu-g++
      export CFLAGS="-I/data/home/nickwu/.miniconda3/envs/my/include/"
      export CXXFLAGS="-I/data/home/nickwu/.miniconda3/envs/my/include/"
      export LDFLAGS="-L/data/home/nickwu/.miniconda3/envs/my/lib/ -lpython3"
    fi

    ./configure \
        --with-features=huge \
        --enable-multibyte \
        --with-tlib=tinfo \
        --enable-rubyinterp=yes \
        --enable-python3interp=yes \
        --enable-perlinterp=yes \
        --enable-luainterp=yes \
        --enable-gtk3-check \
        --enable-cscope
    make -j 10
    sudo make install

    cd $HOME
}

function main()
{
    #clean
    installvim

    ln -s $HOME/.vim/vimrc $HOME/.vimrc
    vim -c :PlugInstall -c :q -c :q

    cd $HOME/.vim/plugged/YouCompleteMe/third_party/ycmd
    git checkout c7608ff1b9a1d8cfa9676eaa8e53a4cc0f9585b3
    git submodule update --init --recursive

    python3 $HOME/.vim/plugged/YouCompleteMe/install.py --all

    echo "!!! vim evn install success !!!"
}

main

